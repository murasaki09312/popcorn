<div class="min-h-screen bg-background text-foreground">
  <header class="border-b border-line bg-background">
    <div class="mx-auto w-full max-w-[1100px] px-4 sm:px-8">
      <div class="flex min-h-16 flex-wrap items-center justify-between gap-y-2 py-2 sm:flex-nowrap">
        <p class="shrink-0 font-serif text-[1.55rem] leading-none tracking-[0.08em] text-foreground-strong">popcorn studio</p>
        <nav aria-label="main navigation" class="w-full sm:w-auto">
          <ul class="flex flex-wrap justify-end gap-1 text-[0.74rem] uppercase tracking-[0.15em] sm:gap-3">
          <li>
            <a href="#works" class="nav-link min-touch-target focus-ring inline-flex items-center px-2 transition">works</a>
          </li>
          <li>
            <a href="#about" class="nav-link min-touch-target focus-ring inline-flex items-center px-2 transition">about</a>
          </li>
          <li>
            <a href="#contact" class="nav-link min-touch-target focus-ring inline-flex items-center px-2 transition">contact</a>
          </li>
          <li class="hidden min-[420px]:block">
            <a
              href="<%= @instagram_url %>"
              target="_blank"
              rel="noopener noreferrer"
              aria-label="Instagram"
              class="icon-link min-touch-target focus-ring inline-flex items-center justify-center rounded-full transition"
            >
              <svg viewBox="0 0 24 24" fill="none" class="h-3.5 w-3.5" stroke="currentColor" stroke-width="1.8" aria-hidden="true">
                <rect x="3" y="3" width="18" height="18" rx="5"></rect>
                <circle cx="12" cy="12" r="4.2"></circle>
                <circle cx="17.6" cy="6.4" r="0.9" fill="currentColor" stroke="none"></circle>
              </svg>
            </a>
          </li>
          <li class="hidden min-[420px]:block">
            <a
              href="<%= @youtube_url %>"
              target="_blank"
              rel="noopener noreferrer"
              aria-label="YouTube"
              class="icon-link min-touch-target focus-ring inline-flex items-center justify-center rounded-full transition"
            >
              <svg viewBox="0 0 24 24" fill="none" class="h-3.5 w-3.5" stroke="currentColor" stroke-width="1.8" aria-hidden="true">
                <rect x="3" y="6" width="18" height="12" rx="4"></rect>
                <path d="M10 9.6L15 12L10 14.4V9.6Z" fill="currentColor" stroke="none"></path>
              </svg>
            </a>
          </li>
          </ul>
        </nav>
      </div>
    </div>
  </header>

  <main class="mx-auto w-full max-w-[1100px] space-y-32 px-6 pb-32 pt-20 sm:px-8">
    <section
      id="works"
      class="space-y-12"
      data-controller="video-modal"
      data-action="keydown.esc@window->video-modal#closeWithKeyboard"
    >
      <header class="space-y-3 text-center">
        <h1 class="font-serif text-[clamp(2.75rem,5.4vw,4.35rem)] font-light leading-none tracking-[0.085em] text-foreground-strong">works</h1>
        <p class="mx-auto max-w-2xl text-[0.84rem] leading-relaxed tracking-[0.03em] text-muted">
          音と映像が溶け合う瞬間を、静かな余白とともに編み込みました。気になる作品を選んで、モーダルで再生してください。
        </p>
      </header>

      <div class="grid gap-5 sm:grid-cols-2 sm:gap-7 lg:grid-cols-3 lg:gap-10">
        <% @works.each_with_index do |work, index| %>
          <article>
            <button
              type="button"
              class="animate-fade-in-up focus-ring group card-lift w-full rounded-[1.4rem] border border-line-soft bg-surface p-4 text-left shadow-card transition-all duration-300 sm:p-5"
              style="animation-delay: <%= index * 150 %>ms;"
              data-action="video-modal#open"
              data-video-modal-url-param="<%= work.video_url.to_s %>"
              data-video-modal-title-param="<%= work.title.to_s %>"
              data-video-modal-tags-param="<%= work.tags.to_s %>"
              data-video-modal-description-param="<%= work.description.to_s %>"
              aria-haspopup="dialog"
              aria-controls="works-video-modal"
              aria-expanded="false"
            >
              <div class="relative aspect-[3/2] overflow-hidden rounded-[1.1rem] bg-surface-soft">
                <% if work.thumbnail.attached? %>
                  <%= image_tag work.thumbnail, alt: "#{work.title} thumbnail", loading: "lazy", decoding: "async", class: "h-full w-full object-cover transition-transform duration-700 ease-in-out group-hover:scale-[1.04]" %>
                <% else %>
                  <div class="h-full w-full bg-surface-soft"></div>
                <% end %>
                <div class="media-overlay absolute inset-0 opacity-0 transition-opacity duration-500 group-hover:opacity-100"></div>
              </div>
              <p class="mt-4 font-serif text-[1.04rem] leading-snug tracking-[0.02em] text-foreground-strong"><%= work.title %></p>
              <p class="mt-1.5 text-[0.77rem] leading-relaxed tracking-[0.075em] text-subtle"><%= work.tags.presence || "-" %></p>
            </button>
          </article>
        <% end %>
      </div>

      <% if @works.empty? %>
        <p class="rounded-2xl border border-line-soft bg-surface p-5 text-sm text-subtle">作品がまだ登録されていません。</p>
      <% end %>

      <div
        class="bg-overlay fixed inset-0 z-50 hidden items-center justify-center p-4 backdrop-blur-[1px] sm:p-6"
        data-video-modal-target="overlay"
        data-action="click->video-modal#closeFromBackdrop"
        aria-hidden="true"
      >
        <div
          id="works-video-modal"
          class="shadow-soft relative w-full max-w-5xl overflow-hidden rounded-3xl border border-line-soft bg-surface"
          role="dialog"
          aria-modal="true"
          aria-labelledby="work-modal-title"
          aria-describedby="work-modal-description"
          data-action="click->video-modal#stopPropagation"
          data-video-modal-target="dialog"
          tabindex="-1"
        >
          <button
            type="button"
            class="focus-ring absolute right-3 top-3 z-10 inline-flex h-11 w-11 items-center justify-center rounded-full border border-line-strong bg-surface text-lg text-foreground transition hover:bg-surface-soft"
            data-action="video-modal#close"
            data-video-modal-target="closeButton"
            aria-label="モーダルを閉じる"
          >
            ×
          </button>

          <div class="grid gap-4 p-4 md:grid-cols-[minmax(0,1.8fr)_minmax(0,1fr)] md:gap-6 md:p-6">
            <div class="space-y-3">
              <div class="aspect-video overflow-hidden rounded-2xl border border-line-soft bg-surface-soft">
                <video class="h-full w-full" controls playsinline data-video-modal-target="videoPlayer"></video>
                <iframe
                  class="hidden h-full w-full"
                  data-video-modal-target="iframePlayer"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                  allowfullscreen
                ></iframe>
                <div class="hidden h-full w-full items-center justify-center px-4 text-sm text-subtle" data-video-modal-target="fallback">
                  <p>
                    動画を埋め込み表示できません。
                    <a
                      href="#"
                      target="_blank"
                      rel="noopener noreferrer"
                      class="focus-ring hidden underline underline-offset-2 transition hover:text-foreground-strong"
                      data-video-modal-target="fallbackLink"
                    >元動画を開く</a>
                  </p>
                </div>
              </div>
            </div>

            <div class="max-h-[55vh] space-y-4 overflow-y-auto pr-1 text-sm md:max-h-[70vh]">
              <p id="work-modal-title" class="font-serif text-[1.75rem] leading-tight tracking-[0.015em] text-foreground-strong" data-video-modal-target="title"></p>
              <p class="text-[0.72rem] tracking-[0.08em] text-muted" data-video-modal-target="tags"></p>
              <p id="work-modal-description" class="whitespace-pre-wrap text-[0.94rem] leading-7 tracking-[0.015em] text-foreground" data-video-modal-target="description"></p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="about" class="space-y-14">
      <h2 class="text-center font-serif text-[clamp(2.7rem,5vw,4.1rem)] font-light leading-none tracking-[0.085em] text-foreground-strong">about</h2>
      <div class="mx-auto grid max-w-[940px] gap-14 lg:grid-cols-[minmax(0,420px)_minmax(0,1fr)] lg:items-center">
        <figure class="relative">
          <div class="about-glow pointer-events-none absolute -inset-6 -z-10 rounded-[2rem]"></div>
          <div class="shadow-soft aspect-[3/4] overflow-hidden rounded-[1.8rem] border border-line-soft bg-surface-soft">
            <%= image_tag "about-placeholder.svg", class: "h-full w-full object-cover", alt: "popcorn studio members portrait", loading: "lazy" %>
          </div>
        </figure>
        <div class="space-y-6 lg:pb-6">
          <p class="font-serif text-[clamp(2.3rem,4vw,3.4rem)] leading-none tracking-[0.11em] text-foreground-strong">popcorn</p>
          <p class="text-[0.84rem] leading-relaxed tracking-[0.035em] text-foreground">
            トラックメイカーmiyuとアニメーションデザイナーhinからなる、クリエイティブユニット。<br>
            音と映像を軸に、MV・SNSコンテンツ・ブランドビジュアルを制作しています。
          </p>
          <p class="text-[0.72rem] uppercase leading-relaxed tracking-[0.16em] text-muted">Audio direction / Visual storytelling / Brand motion</p>
        </div>
      </div>
    </section>

    <section id="contact" class="space-y-5 text-center">
      <h2 class="font-serif text-[clamp(2.7rem,5vw,4.1rem)] font-light leading-none tracking-[0.085em] text-foreground-strong">contact</h2>
      <p class="text-[0.8rem] leading-relaxed tracking-[0.03em] text-subtle">ご相談・ご依頼はLINEからお気軽にご連絡ください。</p>
      <a
        href="<%= @line_url %>"
        target="_blank"
        rel="noopener noreferrer"
        class="btn-contact min-touch-target focus-ring inline-flex items-center gap-2 rounded-full px-8 py-3 text-[0.78rem] font-medium uppercase tracking-[0.06em] text-white transition"
      >
        <svg viewBox="0 0 24 24" fill="none" class="h-3.5 w-3.5" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <path d="M5 7.5a4.5 4.5 0 0 1 4.5-4.5h5A4.5 4.5 0 0 1 19 7.5v9A4.5 4.5 0 0 1 14.5 21h-5A4.5 4.5 0 0 1 5 16.5v-9Z"></path>
          <path d="M9.5 8.5H14.5"></path>
          <path d="M10.5 12.5H13.5"></path>
        </svg>
        LINEで相談する
      </a>
    </section>
  </main>

  <footer class="border-t border-line px-6 py-8 text-center text-[0.7rem] tracking-[0.06em] text-subtle">
    <%= "#{Time.current.year} popcorn studio.Co." %>
  </footer>
</div>
